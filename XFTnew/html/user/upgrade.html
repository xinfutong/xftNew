<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
	</head>
	<style>
		body{font-family: "微软雅黑";}
		.mui-content{padding: 0 16px 0 14px;margin-bottom: 70px;}
		.rate_type{margin-top: 12px;background-color: #FFFFFF;
			border-radius: 5px;border-top-left-radius: 2px;position: relative;
		}
		.left{width: 22.6%;float: left;padding-bottom: 60px;}
		.left img{width: 44px;margin-top: 21px;margin-left: 16px;}
		.right{}
		.center img{width: 50px;position: absolute;top: 21px;right: 16px;}
		.center{padding: 12px 0;padding-bottom: 0;width: 77.4%;border-bottom: 1px dashed #DDDDDD;
    float: right;margin-bottom: 11px;}
		.center h5{color: #000000;font-size: 13px;font-weight: 400;}
		.center h4{color: #000000;font-size: 24px;padding: 19px 0;font-weight: 400;}
		.mui-bottom p{padding-bottom: 11px;margin: 0;font-size: 12px;}
		.but{padding: 21px 0;text-align: center;background-color: #108EE9;
		color: #FFFFFF;font-size: 18px;position: fixed;bottom: 0;width: 100%;z-index: 3;}
		/*.mui-scroll{height: 100%;transform: inherit;-webkit-transform:inherit}*/
		/*.mui-scroll-wrapper{position: fixed;}*/  
	</style>	
	<body>
		<header id="header" class="mui-bar mui-bar-nav" style="box-shadow: none;background-color: #FFFFFF;">			
			<h1 class="mui-title">立即升级</h1>
			<button class="mui-action-back mui-btn mui-btn-blue mui-btn-link mui-btn-nav mui-pull-left">
				<span class="mui-icon mui-icon-left-nav"></span>返回
			</button>
		</header>
		
		<div class="mui-content">
			<div class="list-t-wrap">
			    <div id="pullrefresh" class="mui-scroll-wrapper">
			        <div class="mui-scroll">
			            <div class="list-wrapper">
			                <!--列表一定要放到容器内,因为会有一个div append到mui-scroll中,需要在底部才能起作用-->
			           		<div class="rate_type">
								<div class="left">
									<img src="../../images/kj_rate@3x.png" />
								</div>
								<div class="center">
									<h5 id="ageng_id">快捷支付</h5>
									<h4>还款费率<span id="kj_T0"><!--0.55%--></span></h4>				
								</div>
								<div class="mui-bottom">
									<p>充值时间(09:00-21:00)</p>
								</div>
							</div>
							
			            </div>
			        </div>
			    </div>
			</div>
			
			<!--<div class="rate_type">
				<div class="left">
					<img src="../../images/wx_rate@3x.png" />
				</div>
				<div class="center">
					<h5>微信支付</h5>
					<h4>D0费率<span id="wx_t0"></span></h4>					
				</div>
				<div class="mui-bottom">
					<p>即刷即到，秒到时间(09:00-21:00)</p>
				</div>
			</div>
			<div class="rate_type">
				<div class="left">
					<img src="../../images/wx_rate@3x.png" />
				</div>
				<div class="center">
					<h5>微信支付</h5>
					<h4>T1费率<span id="wx_t1"></span></h4>					
				</div>
				<div class="mui-bottom">
					<p>第二个工作日到账，节假日顺延</p>
				</div>
			</div>
			<div class="rate_type">
				<div class="left">
					<img src="../../images/wx_rate@3x.png" />
				</div>
				<div class="center">
					<h5>微信支付</h5>
					<h4>T5费率<span id="wx_t5"></span></h4>					
				</div>
				<div class="mui-bottom">
					<p>第五个工作日到账，节假日顺延</p>
				</div>
			</div>
			<div class="rate_type">
				<div class="left">
					<img src="../../images/zfb_rate@3x.png" />
				</div>
				<div class="center">
					<h5>支付宝支付</h5>
					<h4>D0费率<span id="zfb_t0"></span></h4>					
				</div>
				<div class="mui-bottom">
					<p>秒到时间(09:00-21:00)</p>
				</div>
			</div>-->
		</div>
		<div class="but" id="pay_upgrade">
			升级<span id="mui-title">区级代理商</span>￥<span id="vip_pay">200.00</span>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/immersed.js" ></script>
		<script type="text/javascript">
			mui.plusReady(function(){
				mui.init({  
					pullRefresh: 
				    {
				      container: '#pullrefresh',
				      down: {
				      	height: 50, //可选,默认50.触发下拉刷新拖动距离,
						auto: false, //可选,默认false.自动下拉刷新一次
						contentdown: "", //可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
						contentover: "释放立即回弹", //可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
						contentrefresh: "", //可选，正在刷新状态时，下拉刷新控件上显示的标题内容
				        callback: pulldownRefresh
				      },//http://www.cnblogs.com/CyLee/p/5324224.html				      
				   	},
					hardwareAccelerated:true, //开启硬件加速	
					
				});
				function pulldownRefresh() {
					setTimeout(function() {
//					alert(&quot;shuaxin&quot;);
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
					})
				}
				// 创建加载内容窗口
				var topoffset='45px';
				if(plus.navigator.isImmersedStatusbar()){// 兼容immersed状态栏模式
					topoffset=(Math.round(plus.navigator.getStatusbarHeight())+45)+'px';
				} 
				document.getElementById('header').style.height=(immersed+44)+'px';
//				document.querySelector('.mui-content').style.marginTop=(immersed)+'px';
				if(mui.os.ios){
					document.querySelector('.mui-content').style.marginTop=(immersed+44)+'px';
					document.querySelector('.mui-scroll').style.marginTop=(immersed+45)+'px';
				}else if(mui.os.android){
					document.querySelector('#pullrefresh').style.marginTop=(immersed+44)+'px';
				}
				
				var agent_id=plus.webview.getWebviewById('upgrade').agent_id;
				var uid=plus.storage.getItem('uid');
				var token=plus.storage.getItem('token');
				if(agent_id==2){
					document.getElementById('mui-title').innerText='会员';
					document.getElementById('ageng_id').innerText='会员';
				}else if(agent_id==4){
					document.getElementById('mui-title').innerText='市级代理';
					document.getElementById('ageng_id').innerText='市级代理';
				}else if(agent_id==5){
					document.getElementById('mui-title').innerText='省级代理';
					document.getElementById('ageng_id').innerText='省级代理';
				}else if(agent_id==6){
					document.getElementById('mui-title').innerText='合伙人';
					document.getElementById('ageng_id').innerText='合伙人';
				}else if(agent_id==3){
					document.getElementById('ageng_id').innerText='VIP会员';
					document.getElementById('mui-title').innerText='VIP会员';
				}
				var order;
				mui.ajax('http://www.zhxft.com/app/customer/upgrade_vip',{
					async:false,
					data:{
						uid:uid,
						token:token,
						type_id:agent_id
					},
					dataType:'JSON',//服务器返回json格式数据
					type:'post',//HTTP请求类型
					success:function(data){
						console.log(data);
						var arrParse = JSON.parse(data);
						if(arrParse.info.code==6){
							plus.storage.clear();
							plus.storage.setItem("launchFlag", "林允");
							mui.confirm('你当前并未登录(或账号在其他手机登录以致此手机账号被退出)，是否前往登录！','提示',['是','否'],function(e){
								if(e.index==0){
									mui.openWindow({
										url: '../index/login.html',
										id: 'login',
										show: {
											autoShow:false,
											aniShow: 'pop-in',
											duration:'350',
										}//额外扩展参数
										,createNew:true,extras:{type:1},//是否重复创建同样id的webview，默认为false:不重复创建，直接显示
										styles:{softinputMode:'adjustResize'},
										waiting: {
											autoShow: true
										}
									});
								}
							},'div')
							return;
						}
						order=arrParse.formNo;
						document.getElementById('vip_pay').innerText=arrParse.pay;
						document.getElementById('kj_T0').innerText=(arrParse.kj_D0*100).toFixed(2)+'%';
//						document.getElementById('wx_t0').innerText=(arrParse.wx_D0*100).toFixed(2)+'%';	
//						document.getElementById('wx_t1').innerText=(arrParse.wx_T1*100).toFixed(2)+'%';	
//						document.getElementById('wx_t5').innerText=(arrParse.wx_T5*100).toFixed(2)+'%';	
//						document.getElementById('zfb_t0').innerText=(arrParse.wx_D0*100).toFixed(2)+'%';
					},
					error:function(xhr,error,errorThrown){
						console.log(error);
					}
				});
				document.getElementById('pay_upgrade').addEventListener('tap',function(){
					var vip=document.getElementById('vip_pay').innerText;
					mui.openWindow({
						url: 'upgrade_pay.html',
						id: 'upgrade_pay',
						show: {
							autoShow:false,
							aniShow: 'pop-in',
							duration:'350',
						},styles:{
//							bounce: 'vertical',bounceBackground:'#fc1',
						},
					    extras:{
					      	pay_money:vip,
					      	type:agent_id,
					      	order_id:order
					    },createNew:true,
						waiting: {
							autoShow: true
						}
					});
//					mui.ajax('http://www.zhxft.com/app/customer/confirm_upgrade_vip',{
//						async:false,
//						data:{
//							uid:uid,
//							token:token,
//							type_id:agent_id,
//							pay:vip
//						},
//						dataType:'JSON',//服务器返回json格式数据
//						type:'post',//HTTP请求类型
//						success:function(data){
//							console.log(data);
//							var arrParse = JSON.parse(data);	
//							if(arrParse.info.code==0){
////								mui.alert('升级成功！','提示','','','div');
//								plus.runtime.openURL(arrParse.code_url);
//							}else{
//								mui.alert('升级失败！','提示','','','div');
//							}
//						},
//						error:function(xhr,error,errorThrown){
//							console.log(error);
//						}
//					});
				})
				
				//（跳转到的页面）关闭页面跳转动画
				plus.nativeUI.closeWaiting();
				//显示当前页面
				var self = plus.webview.currentWebview();
				self.show('pop-in',350);
			});
		</script>
	</body>

</html>