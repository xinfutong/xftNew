<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
	</head>
	<style>
		body{font-family: "微软雅黑";}
		.mui-content{background-color: #FFFFFF;margin-top: 12px;margin-top: 56px;}
		.mui-segmented-control .mui-control-item.mui-active{
			background-color: #FFFFFF;color: #108EE9;
			border-bottom: 2px solid #108EE9;
		}
		.mui-segmented-control{border: 0;}
		.mui-segmented-control .mui-control-item{
			border-left: 0;color: #010101;
			width: 40%;
		    display: inline-block;
		    margin: 0 5%;
		}
		.mui-table-view-cell>.mui-badge{right: 34px;}
		.mui-badge{background-color: #FFFFFF;border-radius:0;color: #505050;font-size: 15px;}
		.mui-action-back label{font-family: "微软雅黑";}
		.mui-bar-nav~.mui-content{padding-top: 0;}
		.mui-table-view:before{height: 0;}
		/*#item1 li{padding: 18px 20px;}*/
		.mui-table-view .mui-media-object{width: 40px;height: 40px;border-radius: 50%;}
		.mui-media-body span{
			display: inline-block;
		    width: 60%;
		    float: left;
		    font-size: 12px;
		    color: #808080;
		}
		.mui-media-body label{
			font-size: 15px;
		    color: #000;
		    display: inline-block;
		    width: 60%;
		}
		.mui-table-view-cell:after,.mui-table-view:after,.mui-table-view:before{-webkit-transform:scaleY(0.5);
            transform:scaleY(0.5);}
        .mui-table-view p{text-align: center;margin-top: 15px;}  
        .D{
            width:100%;
            position: absolute;
            /*top:99.4%;*/
           	bottom: 5px;
            border-top:0.5px solid #999999;
            -webkit-transform:scaleY(0.5);
            transform:scaleY(0.5);
        }  
	</style>
	<body>
		<header id="header" class="mui-bar mui-bar-nav" style="box-shadow: none;background-color: #FFFFFF;">			
			<h1 class="mui-title">代理商列表</h1>
			<button class="mui-action-back mui-btn mui-btn-blue mui-btn-link mui-btn-nav mui-pull-left">
				<span class="mui-icon mui-icon-left-nav"></span>返回
			</button>
		</header>		
		<div class="mui-content">
			<div>
				<div id="segmentedControl" class="mui-segmented-control" style="height: 40px;position: relative;">
					<div class="D"></div>
					<a class="mui-control-item mui-active" href="#item1">
						直接推荐
					</a>
					<a class="mui-control-item" href="#item2">
						间接推荐
					</a>					
				</div>
			</div>
			<!--<div>-->
			<div class="list-t-wrap">
			    <div id="pullrefresh" class="mui-scroll-wrapper">
			        <div class="mui-scroll">
			            <div class="list-wrapper">
				<div id="item1" class="mui-control-content mui-active">					
					<ul id="item1_list" class="mui-table-view" style="overflow-y: auto;height: 100%;">
						<p>暂无数据</p>
						<!--<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img_no@3x.png">
								<div class="mui-media-body">
									<label>手机号：13143485858</label>
									<span>分润贡献：￥0.00</span>								
								</div>
							</a>
						</li>
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img@3x.png">
								<div class="mui-media-body">									
									<label>手机号：13143485858</label>
									<span>分润贡献：￥0.00</span>
								</div>
							</a>
						</li>
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img@3x.png">
								<div class="mui-media-body">
									<label>手机号：13143485858</label>
									<span>分润贡献：￥0.00</span>																				
								</div>
							</a>
						</li>
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img@3x.png">
								<div class="mui-media-body">
									<label>手机号：13143485858</label>
									<span>分润贡献：￥0.00</span>									
								</div>
							</a>
						</li>
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img@3x.png">
								<div class="mui-media-body">
									<label>手机号：13143485858</label>
									<span>分润贡献：￥0.00</span>																				
								</div>
							</a>
						</li>
						<li id="new_card" class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img@3x.png">
								<div class="mui-media-body">
									<label>手机号：13143485858</label>
									<span>分润贡献：￥0.00</span>																				
								</div>
							</a>
						</li>-->
					</ul>
				</div>
				<div id="item2" class="mui-control-content">
					<ul id="item2_list" class="mui-table-view" style="overflow-y: auto;height: 100%;">
						<p>暂无数据</p>
						<!--<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img_no@3x.png">
								<div class="mui-media-body">
									<label>手机号：1314****858</label>
									<span>分润贡献：￥0.00</span>								
								</div>
							</a>
						</li>
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img@3x.png">
								<div class="mui-media-body">									
									<label>手机号：1314****858</label>
									<span>分润贡献：￥0.00</span>
								</div>
							</a>
						</li>
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img@3x.png">
								<div class="mui-media-body">
									<label>手机号：1314****858</label>
									<span>分润贡献：￥0.00</span>																				
								</div>
							</a>
						</li>
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img@3x.png">
								<div class="mui-media-body">
									<label>手机号：1314****858</label>
									<span>分润贡献：￥0.00</span>									
								</div>
							</a>
						</li>
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img@3x.png">
								<div class="mui-media-body">
									<label>手机号：1314****858</label>
									<span>分润贡献：￥0.00</span>																				
								</div>
							</a>
						</li>
						<li id="new_card" class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../../images/u_img@3x.png">
								<div class="mui-media-body">
									<label>手机号：1314****858</label>
									<span>分润贡献：￥0.00</span>																				
								</div>
							</a>
						</li>-->
					</ul>
				</div>				
			</div>
			        </div>
			    </div>
			</div>	
			<!--</div>-->
		</div>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/immersed.js" ></script>
		<script type="text/javascript" src="../../js/jquery-1.8.0.min.js" ></script>
		<script type="text/javascript">
			mui.plusReady(function(){
				mui.init
				({
				    pullRefresh: 
				    {
				      container: '#pullrefresh',
				      up: {
				      	height:50,//可选.默认50.触发上拉加载拖动距离
				      	auto:false,//可选,默认false.自动上拉加载一次
				      	contentnomore:'没有更多数据了',
				        contentrefresh: '正在加载...',
				        callback: pullupRefresh
				      }
				   	},			
					hardwareAccelerated:true, //开启硬件加速
					
				});
				// 创建加载内容窗口
				var topoffset='45px';
				if(plus.navigator.isImmersedStatusbar()){// 兼容immersed状态栏模式
					topoffset=(Math.round(plus.navigator.getStatusbarHeight())+45)+'px';
				} 
				document.getElementById('header').style.height=(immersed+44)+'px';
				if(immersed>25){
					document.querySelector('.list-wrapper').style.marginTop=(25)+'px';
				}
				document.querySelector('.mui-content').style.marginTop=(immersed+54)+'px';
				
				var list_id=plus.webview.getWebviewById('agent_list').list_id;
				var uid=plus.storage.getItem('uid');
				var token=plus.storage.getItem('token');
				if(mui.os.ios){
					$('#pullrefresh').css('margin-top','114px')
					$('.D').css('bottom','0px');
				}
				switch (list_id)
				{								 
				case '6':
				  $('.mui-title').text('分公司代理列表');
				  break;
				case '5':
				  $('.mui-title').text('城市合伙人列表');
				  break;
				case '4':
				  $('.mui-title').text('事业合伙人列表');
				  break;				
				}
				
				var load_len;
				var page=0;
				mui.ajax('http://www.zhxft.com/app/wallet/my_agent',{
					async:false,
					data:{
						uid:uid,
						token:token,
						type_id:list_id,
						limit:page
					},
					dataType:'JSON',//服务器返回json格式数据
					type:'post',//HTTP请求类型
					success:function(data){
						console.log(data);
						var arrParse = JSON.parse(data);
						if(arrParse.info.code==6){
							plus.storage.clear();
							plus.storage.setItem("launchFlag", "林允");
							mui.confirm('你当前并未登录(或账号在其他手机登录以致此手机账号被退出)，是否前往登录！','提示',['是','否'],function(e){
								if(e.index==0){
									mui.openWindow({
										url: '../index/login.html',
										id: 'login',
										show: {
											autoShow:false,
											aniShow: 'pop-in',
											duration:'350',
										}//额外扩展参数
										,createNew:true,extras:{type:1},//是否重复创建同样id的webview，默认为false:不重复创建，直接显示
										styles:{softinputMode:'adjustResize'},
										waiting: {
											autoShow: true
										}
									});
								}
							},'div')
							return;
						}
						load_len=(parseFloat(arrParse.count)/10);
						var list1=document.getElementById('item1_list');
						var list2=document.getElementById('item2_list');
						list1.innerHTML='';
						list2.innerHTML='';
						for (var i=0;i<arrParse.datas.length;i++) {
							if(arrParse.datas[i].state==0){
								var jj=arrParse.datas[i].phoneNum.replace(arrParse.datas[i].phoneNum.substring(4,8),'****');
								list2.innerHTML+='<li class="mui-table-view-cell mui-media" id="'+arrParse.datas[i].id+'">'
									+'<a href="javascript:;">'
										+'<img class="mui-media-object mui-pull-left" src="'+arrParse.datas[i].head_portrait+'">'
										+'<div class="mui-media-body">'
											+'<label>手机号：'+jj+'</label>'
											+'<span>分润贡献：￥'+arrParse.datas[i].deductMoney+'</span>'								
										+'</div>'
									+'</a>'
								+'</li>';
							}else if(arrParse.datas[i].state==1){
								list1.innerHTML+='<li class="mui-table-view-cell mui-media" id="'+arrParse.datas[i].id+'">'
									+'<a href="javascript:;">'
										+'<img class="mui-media-object mui-pull-left" src="'+arrParse.datas[i].head_portrait+'">'
										+'<div class="mui-media-body">'
											+'<label>手机号：'+arrParse.datas[i].phoneNum+'</label>'
											+'<span>分润贡献：￥'+arrParse.datas[i].deductMoney+'</span>'								
										+'</div>'
									+'</a>'
								+'</li>';
							}
						}
					},
					error:function(xhr,error,errorThrown){
						console.log(error);
					}
				});
				
//				if(mui.os.plus) {  
//				    mui.plusReady(function() {  
//				        setTimeout(function() { mui('#pullrefresh').pullRefresh().pullupLoading(); }, 1000);  
//				    });  
//				} else {  
//				    mui.ready(function() {
//				        mui('#pullrefresh').pullRefresh().pullupLoading();   
//				    });  
//				} 
				var count = 0;
			  /*
			   * 上拉加载具体业务实现
			   * mui('#pullrefresh').pullRefresh().refresh(true);     //恢复滚动
				mui('#pullrefresh').pullRefresh().scrollTo(0,0,100); //滚动置顶
			   */
			  function pullupRefresh() 
			  {
			    setTimeout(function() {
			      mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > load_len)); //参数为true代表没有更多数据了。
			      if(count > load_len){
			      	mui.toast('已经没有更多可加载的了',{ duration:'long', type:'div' }) 
//			      	mui.alert('已经没有更多可加载的了','提示','','','div');
			      }
			      var cells = document.body.querySelectorAll('.card');
			      page++;
			      var num=page*10;
					mui.ajax('http://www.zhxft.com/app/wallet/my_agent',{
						async:false,
						data:{
							uid:uid,
							token:token,
							type_id:list_id,
							limit:num
						},
						dataType:'JSON',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						success:function(data){
							console.log(data);
							var arrParse = JSON.parse(data);
							if(arrParse.info.code==6){
								plus.storage.clear();
								plus.storage.setItem("launchFlag", "林允");
								mui.confirm('你当前并未登录(或账号在其他手机登录以致此手机账号被退出)，是否前往登录！','提示',['是','否'],function(e){
									if(e.index==0){
										mui.openWindow({
											url: '../index/login.html',
											id: 'login',
											show: {
												autoShow:false,
												aniShow: 'pop-in',
												duration:'350',
											}//额外扩展参数
											,createNew:true,extras:{type:1},//是否重复创建同样id的webview，默认为false:不重复创建，直接显示
											styles:{softinputMode:'adjustResize'},
											waiting: {
												autoShow: true
											}
										});
									}
								},'div')
								return;
							}
							var list1=document.getElementById('item1_list');
							var list2=document.getElementById('item2_list');
							
							for (var i=0;i<arrParse.datas.length;i++) {
								if(arrParse.datas[i].state==0){
									var jj=arrParse.datas[i].phoneNum.replace(arrParse.datas[i].phoneNum.substring(4,8),'****');
									list2.innerHTML+='<li class="mui-table-view-cell mui-media" id="'+arrParse.datas[i].id+'">'
										+'<a href="javascript:;">'
											+'<img class="mui-media-object mui-pull-left" src="'+arrParse.datas[i].head_portrait+'">'
											+'<div class="mui-media-body">'
												+'<label>手机号：'+jj+'</label>'
												+'<span>分润贡献：￥'+arrParse.datas[i].deductMoney+'</span>'								
											+'</div>'
										+'</a>'
									+'</li>';
								}else if(arrParse.datas[i].state==1){
									list1.innerHTML+='<li class="mui-table-view-cell mui-media" id="'+arrParse.datas[i].id+'">'
										+'<a href="javascript:;">'
											+'<img class="mui-media-object mui-pull-left" src="'+arrParse.datas[i].head_portrait+'">'
											+'<div class="mui-media-body">'
												+'<label>手机号：'+arrParse.datas[i].phoneNum+'</label>'
												+'<span>分润贡献：￥'+arrParse.datas[i].deductMoney+'</span>'								
											+'</div>'
										+'</a>'
									+'</li>';
								}
							}
						},
						error:function(xhr,error,errorThrown){
							console.log(error);
						}
					});
			    }, 500);
				}
				
				mui('#item1').on('tap','li',function(){
					var i=$(this).index();
					var u_id=$(this).attr('id');
					mui.openWindow({
						url: 'details_zj.html',
						id: 'details_zj',
						show: {
							autoShow:false,
							aniShow: 'pop-in',
							duration:'350',
						},
					    extras:{
					      	list_id:i,
					      	u_id:u_id,
					      	list_type:1
					    },styles:{
//							bounce: 'vertical',bounceBackground:'#fc1',
						},
						waiting: {
							autoShow: true
						}
					});
				});
				mui('#item2').on('tap','li',function(){
					var i=$(this).index();
					var u_id=$(this).attr('id');
					mui.openWindow({
						url: 'details_jj.html',
						id: 'details_jj',
						show: {
							autoShow:false,
							aniShow: 'pop-in',
							duration:'350',
						},
					    extras:{
					      	list_id:i,
					      	u_id:u_id
					    },styles:{
//							bounce: 'vertical',bounceBackground:'#fc1',
						},
						waiting: {
							autoShow: true
						}
					});
				});
				
				//（跳转到的页面）关闭页面跳转动画
				plus.nativeUI.closeWaiting();
				//显示当前页面
				var self = plus.webview.currentWebview();
				self.show('pop-in',350);
			})
		</script>
	</body>

</html>